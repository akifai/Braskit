<!DOCTYPE html>
<html>
<head>
  <title>
    {% if title %}{{ title }} - {% endif %}
    {% if board %}
      {% if not title %}/{{ board }}/ - {% endif %}
      {{ board.title }}
    {% else %}
      {{ config.site_name }}
    {% endif %}
  </title>

  <meta charset="utf-8">
  <link rel="stylesheet" id="sitestyle" href="{{ less("futaba.less") }}" title="Futaba">
  <script>
  {% autoescape "js" %}
    var lessHandler = "{{ path("less.php") }}";
    var styles = {
      "Burichan": "burichan.less",
      "Futaba": "futaba.less",
      "Tomorrow": "tomorrow.less"
    };

    function changeStyle(name) {
      var link = document.getElementById("sitestyle");
      if (link)
        link.href = lessHandler + "?file=" + styles[name];
    }

    function Cookie(options) {
      var expires = 86400 * 365;

      if (typeof options === "object" && expires in options) {
        var date = new Date();
        expires = date.setTime(date.getTime() + options.expires);
      }

      this.get = function(name) {
        name = escape(name);

        var regex = new RegExp("(?:^|;\\s+)" + name + "=(.*?)(?:;|$)");
        var match = regex.exec(document.cookie);

        if (!match || match.length < 2)
          return false;

        var value = unescape(match[1]);

        return value;
      };

      this.set = function(name, value) {
        name = escape(name);
        value = escape(value);

        var cookie = name + "=" + value + "; path=/";

        if (expires)
          cookie += "; expires=" + expires;

        document.cookie = cookie;
      };
    }

    !function() {
      var style = new Cookie().get("style");
      if (style)
        changeStyle(style);
    }();
  {% endautoescape %}
  </script>
</head>
<body>
  <div id="topmenu" class="boardmenu">
    <div class="rightmenu">
      {# Style selector #}
      <span class="noscreen ss-unhide"><span class="ss-list"></span> -</span>

      {% if admin %}
        [<a href="{{ path("manage", true) }}">Manage</a>]
        [<a href="{{ path("bans", true) }}">Bans</a>]
        {% if board %}
          [<a href="{{ board.path("rebuild", true) }}">Rebuild caches</a>]
        {% endif %}
        [<a href="{{ path("logout", true) }}">Log out</a>]
        -
      {% endif %}

      [<a href="{{ config.home_url }}" target="_top">Home</a>]

      {% if not admin %}
        [<a href="{{ path("login", true) }}">Manage</a>]
      {% endif %}
    </div>
  </div>

  <div id="logo">
    {%- block header -%}
      <h1 id="header">{% if board %}/{{ board }}/ - {{ board.title }}{% else %}{{ config.site_name }}{% endif %}</h1>
      {%- if subheader -%}
        <div id="subheader">{{ subheader }}</div>
      {%- endif -%}
    {%- endblock -%}
  </div>

  <hr>

  {% block modeheader %}
    {% if admin %}
      <div class="theader">Manager Mode{% if manatitle %}: {{ manatitle }}{% endif %}</div>
    {% endif %}
  {% endblock %}
  {% block content %}{% endblock %}

  <div id="bottommenu" class="boardmenu">{# TODO #}</div>

  <p class="footer">
    - <a href="https://github.com/frankusrs/PlainIB/" target="_top">PlainIB</a>
    + <a href="http://www.2chan.net/script/" target="_top">futaba</a>
    -
  </p>

  <script src="{{ path("static/js/jquery-1.9.0.min.js") }}"></script>
  <script src="{{ path("static/js/PlainIB.js") }}"></script>
</body>
</html>
